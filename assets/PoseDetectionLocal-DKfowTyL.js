import{B as E,_ as H}from"./VueWebcam.vue_vue_type_script_setup_true_lang-qJpK7rsN.js";import{s as I,m as L,p}from"./pose-detection.esm-pMWlMgGU.js";import{u as P}from"./useLoadModel-9s-xtA6C.js";import{d as T,l as _,m as W,q as A,o as B,c as C,e as v,a as U}from"./index-B6JO8PmD.js";const j={class:"flex items-center justify-center w-full flex-grow"},F={class:"ml-auto mr-auto relative w-[1280px] h-[720px]"},w=2,M=4,d=.5,V=T({__name:"PoseDetectionLocal",setup(N){const{resetLoading:y,loaded:g}=P();y();const f=_(),m=_(),c=I.MoveNet;let i,u;const S=async()=>{i=await L(c,{modelUrl:"/tensorflow/models/pose-detection/movenet-tfjs-singlepose-lightning-v4/model.json"}),setTimeout(()=>{h()},500)},h=async()=>{const e=f.value,o=m.value;if(typeof e<"u"&&e!==null&&e.video.readyState===4){const s=e.video,t=s.videoWidth,l=s.videoHeight;s.width=t,s.height=l,o.width=t,o.height=l;const n=o.getContext("2d"),a=await i.estimatePoses(s,{flipHorizontal:!1,maxPoses:1});g(),k(n,a[0].keypoints),D(n,a[0].keypoints),u=requestAnimationFrame(()=>h())}};function k(e,o){const s=p.getKeypointIndexBySide(c);e.strokeStyle="White",e.lineWidth=w,e.fillStyle="Red";for(const t of s.middle)r(e,o[t]);e.fillStyle="Green";for(const t of s.left)r(e,o[t]);e.fillStyle="Orange";for(const t of s.right)r(e,o[t])}function r(e,o){if((o.score??1)>=d){const t=new Path2D;t.arc(o.x,o.y,M,0,2*Math.PI),e.fill(t),e.stroke(t)}}function D(e,o){const s="White";e.fillStyle=s,e.strokeStyle=s,e.lineWidth=w,p.getAdjacentPairs(c).forEach(([t,l])=>{const n=o[t],a=o[l],R=n.score??1,b=a.score??1;R>=d&&b>=d&&(e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(a.x,a.y),e.stroke())})}return W(async()=>{await E("webgl"),S()}),A(()=>{i==null||i.dispose(),cancelAnimationFrame(u)}),(e,o)=>(B(),C("div",j,[v("div",F,[U(H,{ref_key:"webcamRef",ref:f,class:"w-full h-full absolute"},null,512),v("canvas",{ref_key:"canvasRef",ref:m,class:"w-full h-full top-0 left-0 absolute z-10"},null,512)])]))}});export{V as default};
