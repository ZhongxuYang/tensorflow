import{B as E,_ as H}from"./VueWebcam.vue_vue_type_script_setup_true_lang-BsNvWbsN.js";import{s as I,m as P,p}from"./pose-detection.esm-CNgdSSrr.js";import{d as W,r as _,o as A,f as B,a as L,c as N,b as y,e as T,u as F}from"./index-CDVHp2Jc.js";const M={className:"flex items-center justify-center w-full flex-grow"},U={className:"ml-auto mr-auto relative w-[1280px] h-[720px]"},v=2,C=4,f=.5,z=W({__name:"PoseDetection",setup(K){const{resetLoading:w,loaded:g}=F();w();const d=_(),m=_(),c=I.MoveNet;let i,u;const S=async()=>{i=await P(c),h()},h=async()=>{const e=d.value,o=m.value;if(typeof e<"u"&&e!==null&&e.video.readyState===4){const s=e.video,t=s.videoWidth,l=s.videoHeight;s.width=t,s.height=l,o.width=t,o.height=l;const n=o.getContext("2d"),a=await i.estimatePoses(s,{flipHorizontal:!1,maxPoses:1});g(),k(n,a[0].keypoints),D(n,a[0].keypoints),u=requestAnimationFrame(()=>h())}};function k(e,o){const s=p.getKeypointIndexBySide(c);e.strokeStyle="White",e.lineWidth=v,e.fillStyle="Red";for(const t of s.middle)r(e,o[t]);e.fillStyle="Green";for(const t of s.left)r(e,o[t]);e.fillStyle="Orange";for(const t of s.right)r(e,o[t])}function r(e,o){if((o.score??1)>=f){const t=new Path2D;t.arc(o.x,o.y,C,0,2*Math.PI),e.fill(t),e.stroke(t)}}function D(e,o){const s="White";e.fillStyle=s,e.strokeStyle=s,e.lineWidth=v,p.getAdjacentPairs(c).forEach(([t,l])=>{const n=o[t],a=o[l],b=n.score??1,R=a.score??1;b>=f&&R>=f&&(e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(a.x,a.y),e.stroke())})}return A(async()=>{await E("webgl"),S()}),B(()=>{i==null||i.dispose(),cancelAnimationFrame(u)}),(e,o)=>(L(),N("div",M,[y("div",U,[T(H,{ref_key:"webcamRef",ref:d,class:"w-full h-full absolute"},null,512),y("canvas",{ref_key:"canvasRef",ref:m,class:"w-full h-full top-0 left-0 absolute z-10"},null,512)])]))}});export{z as default};
