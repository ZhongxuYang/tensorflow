import{B as E,_ as H}from"./VueWebcam.vue_vue_type_script_setup_true_lang-BsNvWbsN.js";import{s as I,m as L,p}from"./pose-detection.esm-CNgdSSrr.js";import{d as P,r as _,o as T,f as W,a as A,c as B,b as v,e as N,u as C}from"./index-CDVHp2Jc.js";const U={className:"flex items-center justify-center w-full flex-grow"},j={className:"ml-auto mr-auto relative w-[1280px] h-[720px]"},w=2,F=4,d=.5,z=P({__name:"PoseDetectionLocal",setup(M){const{resetLoading:y,loaded:g}=C();y();const f=_(),m=_(),c=I.MoveNet;let i,u;const S=async()=>{i=await L(c,{modelUrl:"/tensorflow/models/pose-detection/movenet-tfjs-singlepose-lightning-v4/model.json"}),setTimeout(()=>{h()},500)},h=async()=>{const e=f.value,o=m.value;if(typeof e<"u"&&e!==null&&e.video.readyState===4){const s=e.video,t=s.videoWidth,l=s.videoHeight;s.width=t,s.height=l,o.width=t,o.height=l;const n=o.getContext("2d"),a=await i.estimatePoses(s,{flipHorizontal:!1,maxPoses:1});g(),k(n,a[0].keypoints),D(n,a[0].keypoints),u=requestAnimationFrame(()=>h())}};function k(e,o){const s=p.getKeypointIndexBySide(c);e.strokeStyle="White",e.lineWidth=w,e.fillStyle="Red";for(const t of s.middle)r(e,o[t]);e.fillStyle="Green";for(const t of s.left)r(e,o[t]);e.fillStyle="Orange";for(const t of s.right)r(e,o[t])}function r(e,o){if((o.score??1)>=d){const t=new Path2D;t.arc(o.x,o.y,F,0,2*Math.PI),e.fill(t),e.stroke(t)}}function D(e,o){const s="White";e.fillStyle=s,e.strokeStyle=s,e.lineWidth=w,p.getAdjacentPairs(c).forEach(([t,l])=>{const n=o[t],a=o[l],b=n.score??1,R=a.score??1;b>=d&&R>=d&&(e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(a.x,a.y),e.stroke())})}return T(async()=>{await E("webgl"),S()}),W(()=>{i==null||i.dispose(),cancelAnimationFrame(u)}),(e,o)=>(A(),B("div",U,[v("div",j,[N(H,{ref_key:"webcamRef",ref:f,class:"w-full h-full absolute"},null,512),v("canvas",{ref_key:"canvasRef",ref:m,class:"w-full h-full top-0 left-0 absolute z-10"},null,512)])]))}});export{z as default};
