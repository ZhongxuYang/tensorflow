import{B as R,_ as E}from"./VueWebcam.vue_vue_type_script_setup_true_lang-DzxA5Gl_.js";import{s as H,m as L,p as _}from"./pose-detection.esm-D-FmlwlU.js";import{d as P,r as v,o as T,f as W,c as A,a as g,b as B,u as C,e as U}from"./index-BHO1i_9P.js";const j={className:"flex items-center justify-center w-full flex-grow"},F={className:"ml-auto mr-auto relative w-[1280px] h-[720px]"},w=2,M=4,f=.5,V=P({__name:"PoseDetectionLocal",setup(K){const{resetLoading:y,loaded:S}=C();y();const m=v(null),u=v(null),r=H.MoveNet;let n,h;const k=async()=>{n=await L(r,{modelUrl:"/tensorflow/models/pose-detection/movenet-tfjs-singlepose-lightning-v4/model.json"}),setTimeout(()=>{p()},500)},p=async()=>{const e=m.value,o=u.value;if(typeof e<"u"&&e!==null&&e.video.readyState===4){const s=e.video,t=s.videoWidth,l=s.videoHeight;s.width=t,s.height=l,o.width=t,o.height=l;const a=await n.estimatePoses(s,{flipHorizontal:!1,maxPoses:1});S(),D(o.getContext("2d"),a[0].keypoints),b(o.getContext("2d"),a[0].keypoints,a.id),h=requestAnimationFrame(()=>p())}};function D(e,o){const s=_.getKeypointIndexBySide(r);e.strokeStyle="White",e.lineWidth=w,e.fillStyle="Red";for(const t of s.middle)d(e,o[t]);e.fillStyle="Green";for(const t of s.left)d(e,o[t]);e.fillStyle="Orange";for(const t of s.right)d(e,o[t])}function d(e,o){if((o.score!=null?o.score:1)>=f){const t=new Path2D;t.arc(o.x,o.y,M,0,2*Math.PI),e.fill(t),e.stroke(t)}}function b(e,o,s){const t="White";e.fillStyle=t,e.strokeStyle=t,e.lineWidth=w,_.getAdjacentPairs(r).forEach(([l,a])=>{const i=o[l],c=o[a],I=i.score!=null?i.score:1,N=c.score!=null?c.score:1;I>=f&&N>=f&&(e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(c.x,c.y),e.stroke())})}return T(async()=>{await R("webgl"),k()}),W(()=>{n==null||n.dispose(),n=null,cancelAnimationFrame(h)}),(e,o)=>(U(),A("div",j,[g("div",F,[B(E,{ref_key:"webcamRef",ref:m,className:"w-full h-full absolute"},null,512),g("canvas",{ref_key:"canvasRef",ref:u,className:"w-full h-full top-0 left-0 absolute z-10"},null,512)])]))}});export{V as default};
