import{l as on,f as un,T as j,t as w,a as dn,e as cn,c as hn,b as ln,d as A,s as L,g as z,h as C,m as M,i as G,j as fn,r as R,k as rn,n as I,o as K,p as pn,q as T,_ as mn}from"./VueWebcam.vue_vue_type_script_setup_true_lang-DOhUs8EB.js";import{d as vn,r as U,o as gn,a as Pn,c as bn,b as q,e as yn,u as kn}from"./index-B_aZzzx2.js";/**
    * @license
    * Copyright 2023 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */function y(i,n,o,t){return new(o||(o=Promise))(function(e,a){function s(h){try{d(t.next(h))}catch(r){a(r)}}function u(h){try{d(t.throw(h))}catch(r){a(r)}}function d(h){var r;h.done?e(h.value):(r=h.value,r instanceof o?r:new o(function(l){l(r)})).then(s,u)}d((t=t.apply(i,[])).next())})}function k(i,n){var o,t,e,a,s={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(d){return function(h){return function(r){if(o)throw new TypeError("Generator is already executing.");for(;a&&(a=0,r[0]&&(s=0)),s;)try{if(o=1,t&&(e=2&r[0]?t.return:r[0]?t.throw||((e=t.return)&&e.call(t),0):t.next)&&!(e=e.call(t,r[1])).done)return e;switch(t=0,e&&(r=[2&r[0],e.value]),r[0]){case 0:case 1:e=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,t=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(e=s.trys,!((e=e.length>0&&e[e.length-1])||r[0]!==6&&r[0]!==2)){s=0;continue}if(r[0]===3&&(!e||r[1]>e[0]&&r[1]<e[3])){s.label=r[1];break}if(r[0]===6&&s.label<e[1]){s.label=e[1],e=r;break}if(e&&s.label<e[2]){s.label=e[2],s.ops.push(r);break}e[2]&&s.ops.pop(),s.trys.pop();continue}r=n.call(i,s)}catch(l){r=[6,l],t=0}finally{o=e=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([d,h])}}}function B(i,n,o){if(o||arguments.length===2)for(var t,e=0,a=n.length;e<a;e++)!t&&e in n||(t||(t=Array.prototype.slice.call(n,0,e)),t[e]=n[e]);return i.concat(t||Array.prototype.slice.call(n))}function V(i){return[Math.abs(i.endPoint[0]-i.startPoint[0]),Math.abs(i.endPoint[1]-i.startPoint[1])]}function S(i){return[i.startPoint[0]+(i.endPoint[0]-i.startPoint[0])/2,i.startPoint[1]+(i.endPoint[1]-i.startPoint[1])/2]}function J(i,n){n===void 0&&(n=1.5);var o=S(i),t=V(i),e=[n*t[0]/2,n*t[1]/2];return{startPoint:[o[0]-e[0],o[1]-e[1]],endPoint:[o[0]+e[0],o[1]+e[1]],palmLandmarks:i.palmLandmarks}}function $(i){var n=S(i),o=V(i),t=Math.max.apply(Math,o)/2;return{startPoint:[n[0]-t,n[1]-t],endPoint:[n[0]+t,n[1]+t],palmLandmarks:i.palmLandmarks}}function Q(i,n){var o=[i.endPoint[0]-i.startPoint[0],i.endPoint[1]-i.startPoint[1]],t=[o[0]*n[0],o[1]*n[1]];return{startPoint:[i.startPoint[0]+t[0],i.startPoint[1]+t[1]],endPoint:[i.endPoint[0]+t[0],i.endPoint[1]+t[1]],palmLandmarks:i.palmLandmarks}}var wn=function(){function i(n,o,t,e,a,s){this.model=n,this.width=o,this.height=t,this.iouThreshold=a,this.scoreThreshold=s,this.anchors=e.map(function(u){return[u.x_center,u.y_center]}),this.anchorsTensor=ln(this.anchors),this.inputSizeTensor=A([o,t]),this.doubleInputSizeTensor=A([2*o,2*t])}return i.prototype.normalizeBoxes=function(n){var o=this;return w(function(){var t=L(n,[0,0],[-1,2]),e=L(n,[0,2],[-1,2]),a=z(C(t,o.inputSizeTensor),o.anchorsTensor),s=C(e,o.doubleInputSizeTensor),u=M(G(a,s),o.inputSizeTensor),d=M(z(a,s),o.inputSizeTensor);return fn([u,d],1)})},i.prototype.normalizeLandmarks=function(n,o){var t=this;return w(function(){var e=z(C(R(n,[-1,7,2]),t.inputSizeTensor),t.anchors[o]);return M(e,t.inputSizeTensor)})},i.prototype.getBoundingBoxes=function(n){return y(this,void 0,void 0,function(){var o,t,e,a,s,u,d,h,r,l,f,c,m,v,g,P=this;return k(this,function(p){switch(p.label){case 0:return o=w(function(){return M(G(n,.5),2)}),rn()==="webgl"?(e=I().get("WEBGL_PACK_DEPTHWISECONV"),I().set("WEBGL_PACK_DEPTHWISECONV",!0),t=this.model.predict(o),I().set("WEBGL_PACK_DEPTHWISECONV",e)):t=this.model.predict(o),a=K(t),s=w(function(){return K(pn(L(a,[0,0],[-1,1])))}),u=L(a,[0,1],[-1,4]),d=this.normalizeBoxes(u),h=console.warn,console.warn=function(){},r=T.nonMaxSuppression(d,s,1,this.iouThreshold,this.scoreThreshold),console.warn=h,[4,r.array()];case 1:return l=p.sent(),f=[o,t,r,a,d,u,s],l.length===0?(f.forEach(function(b){return b.dispose()}),[2,null]):(c=l[0],m=L(d,[c,0],[1,-1]),v=L(a,[c,5],[1,14]),g=w(function(){return R(P.normalizeLandmarks(v,c),[-1,2])}),f.push(v),f.forEach(function(b){return b.dispose()}),[2,{boxes:m,palmLandmarks:g}])}})})},i.prototype.estimateHandBounds=function(n){return y(this,void 0,void 0,function(){var o,t,e,a,s,u,d,h,r=this;return k(this,function(l){switch(l.label){case 0:return o=n.shape[1],t=n.shape[2],e=w(function(){return C(T.resizeBilinear(n,[r.width,r.height]),255)}),[4,this.getBoundingBoxes(e)];case 1:return(a=l.sent())===null?(e.dispose(),[2,null]):(s=a.boxes.arraySync(),u=s[0].slice(0,2),d=s[0].slice(2,4),h=a.palmLandmarks.arraySync(),e.dispose(),a.boxes.dispose(),a.palmLandmarks.dispose(),[2,(f={startPoint:u,endPoint:d,palmLandmarks:h},c=[t/this.width,o/this.height],{startPoint:[f.startPoint[0]*c[0],f.startPoint[1]*c[1]],endPoint:[f.endPoint[0]*c[0],f.endPoint[1]*c[1]],palmLandmarks:f.palmLandmarks.map(function(m){return[m[0]*c[0],m[1]*c[1]]})})])}var f,c})})},i}(),D={thumb:[1,2,3,4],indexFinger:[5,6,7,8],middleFinger:[9,10,11,12],ringFinger:[13,14,15,16],pinky:[17,18,19,20],palmBase:[0]};function xn(i,n){var o,t=Math.PI/2-Math.atan2(-(n[1]-i[1]),n[0]-i[0]);return(o=t)-2*Math.PI*Math.floor((o+Math.PI)/(2*Math.PI))}var X=function(i,n){return[[1,0,i],[0,1,n],[0,0,1]]};function x(i,n){for(var o=0,t=0;t<i.length;t++)o+=i[t]*n[t];return o}function Ln(i,n){for(var o=[],t=0;t<i.length;t++)o.push(i[t][n]);return o}function Y(i,n){for(var o=[],t=i.length,e=0;e<t;e++){o.push([]);for(var a=0;a<t;a++)o[e].push(x(i[e],Ln(n,a)))}return o}function Z(i,n){var o=Math.cos(i),t=Math.sin(i),e=[[o,-t,0],[t,o,0],[0,0,1]],a=Y(X(n[0],n[1]),e);return Y(a,X(-n[0],-n[1]))}function nn(i,n){return[x(i,n[0]),x(i,n[1])]}var Bn=[0,-.4],In=[0,-.1],tn=[0,5,9,13,17,1,2],Cn=function(){function i(n,o,t,e,a,s){this.boundingBoxDetector=n,this.meshDetector=o,this.meshWidth=t,this.meshHeight=e,this.maxContinuousChecks=a,this.detectionConfidence=s,this.regionsOfInterest=[],this.runsWithoutHandDetector=0,this.maxHandsNumber=1}return i.prototype.getBoxForPalmLandmarks=function(n,o){var t=n.map(function(e){return nn(B(B([],e,!0),[1],!1),o)});return J($(Q(this.calculateLandmarksBoundingBox(t),Bn)),3)},i.prototype.getBoxForHandLandmarks=function(n){for(var o=J($(Q(this.calculateLandmarksBoundingBox(n),In)),1.65),t=[],e=0;e<tn.length;e++)t.push(n[tn[e]].slice(0,2));return o.palmLandmarks=t,o},i.prototype.transformRawCoords=function(n,o,t,e){var a,s,u,d,h=this,r=V(o),l=[r[0]/this.meshWidth,r[1]/this.meshHeight],f=n.map(function(p){return[l[0]*(p[0]-h.meshWidth/2),l[1]*(p[1]-h.meshHeight/2),p[2]]}),c=Z(t,[0,0]),m=f.map(function(p){return B(B([],nn(p,c),!0),[p[2]],!1)}),v=(s=[[(a=e)[0][0],a[1][0]],[a[0][1],a[1][1]]],u=[a[0][2],a[1][2]],d=[-x(s[0],u),-x(s[1],u)],[s[0].concat(d[0]),s[1].concat(d[1]),[0,0,1]]),g=B(B([],S(o),!0),[1],!1),P=[x(g,v[0]),x(g,v[1])];return m.map(function(p){return[p[0]+P[0],p[1]+P[1],p[2]]})},i.prototype.estimateHand=function(n){return y(this,void 0,void 0,function(){var o,t,e,a,s,u,d,h,r,l,f,c,m,v,g,P,p,b,E,_;return k(this,function(W){switch(W.label){case 0:return(o=this.shouldUpdateRegionsOfInterest())!==!0?[3,2]:[4,this.boundingBoxDetector.estimateHandBounds(n)];case 1:return(t=W.sent())===null?(n.dispose(),this.regionsOfInterest=[],[2,null]):(this.updateRegionsOfInterest(t,!0),this.runsWithoutHandDetector=0,[3,3]);case 2:this.runsWithoutHandDetector++,W.label=3;case 3:return e=this.regionsOfInterest[0],a=xn(e.palmLandmarks[0],e.palmLandmarks[2]),s=S(e),u=[s[0]/n.shape[2],s[1]/n.shape[1]],d=T.rotateWithOffset(n,a,0,u),h=Z(-a,s),r=o===!0?this.getBoxForPalmLandmarks(e.palmLandmarks,h):e,l=function(H,O,sn){var F=O.shape[1],N=O.shape[2],an=[[H.startPoint[1]/F,H.startPoint[0]/N,H.endPoint[1]/F,H.endPoint[0]/N]];return T.cropAndResize(O,an,[0],sn)}(r,d,[this.meshWidth,this.meshHeight]),f=C(l,255),l.dispose(),d.dispose(),rn()==="webgl"?(m=I().get("WEBGL_PACK_DEPTHWISECONV"),I().set("WEBGL_PACK_DEPTHWISECONV",!0),c=this.meshDetector.predict(f),I().set("WEBGL_PACK_DEPTHWISECONV",m)):c=this.meshDetector.predict(f),v=c[0],g=c[1],f.dispose(),P=v.dataSync()[0],v.dispose(),P<this.detectionConfidence?(g.dispose(),this.regionsOfInterest=[],[2,null]):(p=R(g,[-1,3]),b=p.arraySync(),g.dispose(),p.dispose(),E=this.transformRawCoords(b,r,a,h),_=this.getBoxForHandLandmarks(E),this.updateRegionsOfInterest(_,!1),[2,{landmarks:E,handInViewConfidence:P,boundingBox:{topLeft:_.startPoint,bottomRight:_.endPoint}}])}})})},i.prototype.calculateLandmarksBoundingBox=function(n){var o=n.map(function(e){return e[0]}),t=n.map(function(e){return e[1]});return{startPoint:[Math.min.apply(Math,o),Math.min.apply(Math,t)],endPoint:[Math.max.apply(Math,o),Math.max.apply(Math,t)]}},i.prototype.updateRegionsOfInterest=function(n,o){if(o)this.regionsOfInterest=[n];else{var t=this.regionsOfInterest[0],e=0;if(t!=null&&t.startPoint!=null){var a=n.startPoint,s=a[0],u=a[1],d=n.endPoint,h=d[0],r=d[1],l=t.startPoint,f=l[0],c=l[1],m=t.endPoint,v=m[0],g=m[1],P=Math.max(s,f),p=Math.max(u,c),b=(Math.min(h,v)-P)*(Math.min(r,g)-p);e=b/((h-s)*(r-u)+(v-f)*(g-u)-b)}this.regionsOfInterest[0]=e>.8?t:n}},i.prototype.shouldUpdateRegionsOfInterest=function(){return this.regionsOfInterest.length!==this.maxHandsNumber||this.runsWithoutHandDetector>=this.maxContinuousChecks},i}();function _n(){return y(this,void 0,void 0,function(){return k(this,function(i){return[2,on("https://tfhub.dev/mediapipe/tfjs-model/handdetector/1/default/1",{fromTFHub:!0})]})})}function Hn(){return y(this,void 0,void 0,function(){return k(this,function(i){return[2,on("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1",{fromTFHub:!0})]})})}function Mn(){return y(this,void 0,void 0,function(){return k(this,function(i){return[2,un("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1/anchors.json?tfjs-format=file").then(function(n){return n.json()})]})})}function Tn(i){var n={},o=n.maxContinuousChecks,t=o===void 0?1/0:o,e=n.detectionConfidence,a=e===void 0?.8:e,s=n.iouThreshold,u=s===void 0?.3:s,d=n.scoreThreshold,h=d===void 0?.5:d;return y(this,void 0,void 0,function(){var r,l,f,c,m,v;return k(this,function(g){switch(g.label){case 0:return[4,Promise.all([Mn(),_n(),Hn()])];case 1:return r=g.sent(),l=r[0],f=r[1],c=r[2],m=new wn(f,256,256,l,u,h),v=new Cn(m,c,256,256,t,a),[2,new Sn(v)]}})})}var Sn=function(){function i(n){this.pipeline=n}return i.getAnnotations=function(){return D},i.prototype.estimateHands=function(n,o){return o===void 0&&(o=!1),y(this,void 0,void 0,function(){var t,e,a,s,u,d,h,r,l;return k(this,function(f){switch(f.label){case 0:return t=function(c){return c instanceof j?[c.shape[0],c.shape[1]]:[c.height,c.width]}(n),e=t[1],a=w(function(){return n instanceof j||(n=dn(n)),cn(hn(n,"float32"))}),[4,this.pipeline.estimateHand(a)];case 1:if(s=f.sent(),a.dispose(),s===null)return[2,[]];for(u=s,o===!0&&(u=function(c,m){var v=c.handInViewConfidence,g=c.landmarks,P=c.boundingBox;return{handInViewConfidence:v,landmarks:g.map(function(p){return[m-1-p[0],p[1],p[2]]}),boundingBox:{topLeft:[m-1-P.topLeft[0],P.topLeft[1]],bottomRight:[m-1-P.bottomRight[0],P.bottomRight[1]]}}}(s,e)),d={},h=0,r=Object.keys(D);h<r.length;h++)l=r[h],d[l]=D[l].map(function(c){return u.landmarks[c]});return[2,[{handInViewConfidence:u.handInViewConfidence,boundingBox:u.boundingBox,landmarks:u.landmarks,annotations:d}]]}})})},i}();const en={thumb:[0,1,2,3,4],indexFinger:[0,5,6,7,8],middleFinger:[0,9,10,11,12],ringFinger:[0,13,14,15,16],pinky:[0,17,18,19,20]},En=(i,n)=>{i.length>0&&i.map(o=>{const{landmarks:t}=o;Object.keys(en).map(e=>{const a=en[e];for(let s=0;s<a.length-1;s++){const u=a[s],d=a[s+1];n.beginPath(),n.moveTo(t[u][0],t[u][1]),n.lineTo(t[d][0],t[d][1]),n.strokeStyle="#34eb37",n.lineWidth=2,n.stroke()}}),t.map(e=>{const[a,s]=e;n.beginPath(),n.arc(a,s,5,0,2*Math.PI),n.fillStyle="#eb3434",n.fill()})})},Wn={className:"flex items-center justify-center w-full flex-grow"},On={className:"ml-auto mr-auto relative w-[1280px] h-[720px]"},zn={name:"HandposeComponent"},Vn=vn({...zn,setup(i){const{resetLoading:n,loaded:o}=kn();n();const t=U(),e=U(),a=async()=>{const u=await Tn();setInterval(()=>{s(u)},1)},s=async u=>{const d=t.value,h=e.value;if(typeof d<"u"&&d!==null&&d.video.readyState===4){const r=d.video,l=r.videoWidth,f=r.videoHeight;r.width=l,r.height=f,h.width=l,h.height=f;const c=h.getContext("2d"),m=await u.estimateHands(r);o(),En(m,c)}};return gn(a),(u,d)=>(Pn(),bn("div",Wn,[q("div",On,[yn(mn,{ref_key:"webcamRef",ref:t,class:"w-full h-full absolute"},null,512),q("canvas",{ref_key:"canvasRef",ref:e,class:"w-full h-full top-0 left-0 absolute z-10"},null,512)])]))}});export{Vn as default};
