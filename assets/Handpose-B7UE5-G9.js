import{l as on,f as un,T as j,t as w,a as hn,e as cn,c as dn,b as ln,d as A,s as B,g as z,h as C,m as T,i as G,j as fn,r as R,k as rn,n as L,o as K,p as pn,q as M,_ as mn}from"./VueWebcam.vue_vue_type_script_setup_true_lang-Cx6Rwz6K.js";import{d as vn,r as U,o as gn,c as Pn,a as q,b as bn,e as yn}from"./index-CEMysVEd.js";/**
    * @license
    * Copyright 2023 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */function y(i,n,o,t){return new(o||(o=Promise))(function(e,s){function r(d){try{h(t.next(d))}catch(a){s(a)}}function u(d){try{h(t.throw(d))}catch(a){s(a)}}function h(d){var a;d.done?e(d.value):(a=d.value,a instanceof o?a:new o(function(l){l(a)})).then(r,u)}h((t=t.apply(i,[])).next())})}function k(i,n){var o,t,e,s,r={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(h){return function(d){return function(a){if(o)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(o=1,t&&(e=2&a[0]?t.return:a[0]?t.throw||((e=t.return)&&e.call(t),0):t.next)&&!(e=e.call(t,a[1])).done)return e;switch(t=0,e&&(a=[2&a[0],e.value]),a[0]){case 0:case 1:e=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,t=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(e=r.trys,!((e=e.length>0&&e[e.length-1])||a[0]!==6&&a[0]!==2)){r=0;continue}if(a[0]===3&&(!e||a[1]>e[0]&&a[1]<e[3])){r.label=a[1];break}if(a[0]===6&&r.label<e[1]){r.label=e[1],e=a;break}if(e&&r.label<e[2]){r.label=e[2],r.ops.push(a);break}e[2]&&r.ops.pop(),r.trys.pop();continue}a=n.call(i,r)}catch(l){a=[6,l],t=0}finally{o=e=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([h,d])}}}function I(i,n,o){if(o||arguments.length===2)for(var t,e=0,s=n.length;e<s;e++)!t&&e in n||(t||(t=Array.prototype.slice.call(n,0,e)),t[e]=n[e]);return i.concat(t||Array.prototype.slice.call(n))}function N(i){return[Math.abs(i.endPoint[0]-i.startPoint[0]),Math.abs(i.endPoint[1]-i.startPoint[1])]}function S(i){return[i.startPoint[0]+(i.endPoint[0]-i.startPoint[0])/2,i.startPoint[1]+(i.endPoint[1]-i.startPoint[1])/2]}function J(i,n){n===void 0&&(n=1.5);var o=S(i),t=N(i),e=[n*t[0]/2,n*t[1]/2];return{startPoint:[o[0]-e[0],o[1]-e[1]],endPoint:[o[0]+e[0],o[1]+e[1]],palmLandmarks:i.palmLandmarks}}function $(i){var n=S(i),o=N(i),t=Math.max.apply(Math,o)/2;return{startPoint:[n[0]-t,n[1]-t],endPoint:[n[0]+t,n[1]+t],palmLandmarks:i.palmLandmarks}}function Q(i,n){var o=[i.endPoint[0]-i.startPoint[0],i.endPoint[1]-i.startPoint[1]],t=[o[0]*n[0],o[1]*n[1]];return{startPoint:[i.startPoint[0]+t[0],i.startPoint[1]+t[1]],endPoint:[i.endPoint[0]+t[0],i.endPoint[1]+t[1]],palmLandmarks:i.palmLandmarks}}var kn=function(){function i(n,o,t,e,s,r){this.model=n,this.width=o,this.height=t,this.iouThreshold=s,this.scoreThreshold=r,this.anchors=e.map(function(u){return[u.x_center,u.y_center]}),this.anchorsTensor=ln(this.anchors),this.inputSizeTensor=A([o,t]),this.doubleInputSizeTensor=A([2*o,2*t])}return i.prototype.normalizeBoxes=function(n){var o=this;return w(function(){var t=B(n,[0,0],[-1,2]),e=B(n,[0,2],[-1,2]),s=z(C(t,o.inputSizeTensor),o.anchorsTensor),r=C(e,o.doubleInputSizeTensor),u=T(G(s,r),o.inputSizeTensor),h=T(z(s,r),o.inputSizeTensor);return fn([u,h],1)})},i.prototype.normalizeLandmarks=function(n,o){var t=this;return w(function(){var e=z(C(R(n,[-1,7,2]),t.inputSizeTensor),t.anchors[o]);return T(e,t.inputSizeTensor)})},i.prototype.getBoundingBoxes=function(n){return y(this,void 0,void 0,function(){var o,t,e,s,r,u,h,d,a,l,f,c,m,v,g,P=this;return k(this,function(p){switch(p.label){case 0:return o=w(function(){return T(G(n,.5),2)}),rn()==="webgl"?(e=L().get("WEBGL_PACK_DEPTHWISECONV"),L().set("WEBGL_PACK_DEPTHWISECONV",!0),t=this.model.predict(o),L().set("WEBGL_PACK_DEPTHWISECONV",e)):t=this.model.predict(o),s=K(t),r=w(function(){return K(pn(B(s,[0,0],[-1,1])))}),u=B(s,[0,1],[-1,4]),h=this.normalizeBoxes(u),d=console.warn,console.warn=function(){},a=M.nonMaxSuppression(h,r,1,this.iouThreshold,this.scoreThreshold),console.warn=d,[4,a.array()];case 1:return l=p.sent(),f=[o,t,a,s,h,u,r],l.length===0?(f.forEach(function(b){return b.dispose()}),[2,null]):(c=l[0],m=B(h,[c,0],[1,-1]),v=B(s,[c,5],[1,14]),g=w(function(){return R(P.normalizeLandmarks(v,c),[-1,2])}),f.push(v),f.forEach(function(b){return b.dispose()}),[2,{boxes:m,palmLandmarks:g}])}})})},i.prototype.estimateHandBounds=function(n){return y(this,void 0,void 0,function(){var o,t,e,s,r,u,h,d,a=this;return k(this,function(l){switch(l.label){case 0:return o=n.shape[1],t=n.shape[2],e=w(function(){return C(M.resizeBilinear(n,[a.width,a.height]),255)}),[4,this.getBoundingBoxes(e)];case 1:return(s=l.sent())===null?(e.dispose(),[2,null]):(r=s.boxes.arraySync(),u=r[0].slice(0,2),h=r[0].slice(2,4),d=s.palmLandmarks.arraySync(),e.dispose(),s.boxes.dispose(),s.palmLandmarks.dispose(),[2,(f={startPoint:u,endPoint:h,palmLandmarks:d},c=[t/this.width,o/this.height],{startPoint:[f.startPoint[0]*c[0],f.startPoint[1]*c[1]],endPoint:[f.endPoint[0]*c[0],f.endPoint[1]*c[1]],palmLandmarks:f.palmLandmarks.map(function(m){return[m[0]*c[0],m[1]*c[1]]})})])}var f,c})})},i}(),D={thumb:[1,2,3,4],indexFinger:[5,6,7,8],middleFinger:[9,10,11,12],ringFinger:[13,14,15,16],pinky:[17,18,19,20],palmBase:[0]};function wn(i,n){var o,t=Math.PI/2-Math.atan2(-(n[1]-i[1]),n[0]-i[0]);return(o=t)-2*Math.PI*Math.floor((o+Math.PI)/(2*Math.PI))}var X=function(i,n){return[[1,0,i],[0,1,n],[0,0,1]]};function x(i,n){for(var o=0,t=0;t<i.length;t++)o+=i[t]*n[t];return o}function xn(i,n){for(var o=[],t=0;t<i.length;t++)o.push(i[t][n]);return o}function Y(i,n){for(var o=[],t=i.length,e=0;e<t;e++){o.push([]);for(var s=0;s<t;s++)o[e].push(x(i[e],xn(n,s)))}return o}function Z(i,n){var o=Math.cos(i),t=Math.sin(i),e=[[o,-t,0],[t,o,0],[0,0,1]],s=Y(X(n[0],n[1]),e);return Y(s,X(-n[0],-n[1]))}function nn(i,n){return[x(i,n[0]),x(i,n[1])]}var Bn=[0,-.4],In=[0,-.1],tn=[0,5,9,13,17,1,2],Ln=function(){function i(n,o,t,e,s,r){this.boundingBoxDetector=n,this.meshDetector=o,this.meshWidth=t,this.meshHeight=e,this.maxContinuousChecks=s,this.detectionConfidence=r,this.regionsOfInterest=[],this.runsWithoutHandDetector=0,this.maxHandsNumber=1}return i.prototype.getBoxForPalmLandmarks=function(n,o){var t=n.map(function(e){return nn(I(I([],e,!0),[1],!1),o)});return J($(Q(this.calculateLandmarksBoundingBox(t),Bn)),3)},i.prototype.getBoxForHandLandmarks=function(n){for(var o=J($(Q(this.calculateLandmarksBoundingBox(n),In)),1.65),t=[],e=0;e<tn.length;e++)t.push(n[tn[e]].slice(0,2));return o.palmLandmarks=t,o},i.prototype.transformRawCoords=function(n,o,t,e){var s,r,u,h,d=this,a=N(o),l=[a[0]/this.meshWidth,a[1]/this.meshHeight],f=n.map(function(p){return[l[0]*(p[0]-d.meshWidth/2),l[1]*(p[1]-d.meshHeight/2),p[2]]}),c=Z(t,[0,0]),m=f.map(function(p){return I(I([],nn(p,c),!0),[p[2]],!1)}),v=(r=[[(s=e)[0][0],s[1][0]],[s[0][1],s[1][1]]],u=[s[0][2],s[1][2]],h=[-x(r[0],u),-x(r[1],u)],[r[0].concat(h[0]),r[1].concat(h[1]),[0,0,1]]),g=I(I([],S(o),!0),[1],!1),P=[x(g,v[0]),x(g,v[1])];return m.map(function(p){return[p[0]+P[0],p[1]+P[1],p[2]]})},i.prototype.estimateHand=function(n){return y(this,void 0,void 0,function(){var o,t,e,s,r,u,h,d,a,l,f,c,m,v,g,P,p,b,E,H;return k(this,function(W){switch(W.label){case 0:return(o=this.shouldUpdateRegionsOfInterest())!==!0?[3,2]:[4,this.boundingBoxDetector.estimateHandBounds(n)];case 1:return(t=W.sent())===null?(n.dispose(),this.regionsOfInterest=[],[2,null]):(this.updateRegionsOfInterest(t,!0),this.runsWithoutHandDetector=0,[3,3]);case 2:this.runsWithoutHandDetector++,W.label=3;case 3:return e=this.regionsOfInterest[0],s=wn(e.palmLandmarks[0],e.palmLandmarks[2]),r=S(e),u=[r[0]/n.shape[2],r[1]/n.shape[1]],h=M.rotateWithOffset(n,s,0,u),d=Z(-s,r),a=o===!0?this.getBoxForPalmLandmarks(e.palmLandmarks,d):e,l=function(_,O,sn){var V=O.shape[1],F=O.shape[2],an=[[_.startPoint[1]/V,_.startPoint[0]/F,_.endPoint[1]/V,_.endPoint[0]/F]];return M.cropAndResize(O,an,[0],sn)}(a,h,[this.meshWidth,this.meshHeight]),f=C(l,255),l.dispose(),h.dispose(),rn()==="webgl"?(m=L().get("WEBGL_PACK_DEPTHWISECONV"),L().set("WEBGL_PACK_DEPTHWISECONV",!0),c=this.meshDetector.predict(f),L().set("WEBGL_PACK_DEPTHWISECONV",m)):c=this.meshDetector.predict(f),v=c[0],g=c[1],f.dispose(),P=v.dataSync()[0],v.dispose(),P<this.detectionConfidence?(g.dispose(),this.regionsOfInterest=[],[2,null]):(p=R(g,[-1,3]),b=p.arraySync(),g.dispose(),p.dispose(),E=this.transformRawCoords(b,a,s,d),H=this.getBoxForHandLandmarks(E),this.updateRegionsOfInterest(H,!1),[2,{landmarks:E,handInViewConfidence:P,boundingBox:{topLeft:H.startPoint,bottomRight:H.endPoint}}])}})})},i.prototype.calculateLandmarksBoundingBox=function(n){var o=n.map(function(e){return e[0]}),t=n.map(function(e){return e[1]});return{startPoint:[Math.min.apply(Math,o),Math.min.apply(Math,t)],endPoint:[Math.max.apply(Math,o),Math.max.apply(Math,t)]}},i.prototype.updateRegionsOfInterest=function(n,o){if(o)this.regionsOfInterest=[n];else{var t=this.regionsOfInterest[0],e=0;if(t!=null&&t.startPoint!=null){var s=n.startPoint,r=s[0],u=s[1],h=n.endPoint,d=h[0],a=h[1],l=t.startPoint,f=l[0],c=l[1],m=t.endPoint,v=m[0],g=m[1],P=Math.max(r,f),p=Math.max(u,c),b=(Math.min(d,v)-P)*(Math.min(a,g)-p);e=b/((d-r)*(a-u)+(v-f)*(g-u)-b)}this.regionsOfInterest[0]=e>.8?t:n}},i.prototype.shouldUpdateRegionsOfInterest=function(){return this.regionsOfInterest.length!==this.maxHandsNumber||this.runsWithoutHandDetector>=this.maxContinuousChecks},i}();function Cn(){return y(this,void 0,void 0,function(){return k(this,function(i){return[2,on("https://tfhub.dev/mediapipe/tfjs-model/handdetector/1/default/1",{fromTFHub:!0})]})})}function Hn(){return y(this,void 0,void 0,function(){return k(this,function(i){return[2,on("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1",{fromTFHub:!0})]})})}function _n(){return y(this,void 0,void 0,function(){return k(this,function(i){return[2,un("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1/anchors.json?tfjs-format=file").then(function(n){return n.json()})]})})}function Tn(i){var n={},o=n.maxContinuousChecks,t=o===void 0?1/0:o,e=n.detectionConfidence,s=e===void 0?.8:e,r=n.iouThreshold,u=r===void 0?.3:r,h=n.scoreThreshold,d=h===void 0?.5:h;return y(this,void 0,void 0,function(){var a,l,f,c,m,v;return k(this,function(g){switch(g.label){case 0:return[4,Promise.all([_n(),Cn(),Hn()])];case 1:return a=g.sent(),l=a[0],f=a[1],c=a[2],m=new kn(f,256,256,l,u,d),v=new Ln(m,c,256,256,t,s),[2,new Mn(v)]}})})}var Mn=function(){function i(n){this.pipeline=n}return i.getAnnotations=function(){return D},i.prototype.estimateHands=function(n,o){return o===void 0&&(o=!1),y(this,void 0,void 0,function(){var t,e,s,r,u,h,d,a,l;return k(this,function(f){switch(f.label){case 0:return t=function(c){return c instanceof j?[c.shape[0],c.shape[1]]:[c.height,c.width]}(n),e=t[1],s=w(function(){return n instanceof j||(n=hn(n)),cn(dn(n,"float32"))}),[4,this.pipeline.estimateHand(s)];case 1:if(r=f.sent(),s.dispose(),r===null)return[2,[]];for(u=r,o===!0&&(u=function(c,m){var v=c.handInViewConfidence,g=c.landmarks,P=c.boundingBox;return{handInViewConfidence:v,landmarks:g.map(function(p){return[m-1-p[0],p[1],p[2]]}),boundingBox:{topLeft:[m-1-P.topLeft[0],P.topLeft[1]],bottomRight:[m-1-P.bottomRight[0],P.bottomRight[1]]}}}(r,e)),h={},d=0,a=Object.keys(D);d<a.length;d++)l=a[d],h[l]=D[l].map(function(c){return u.landmarks[c]});return[2,[{handInViewConfidence:u.handInViewConfidence,boundingBox:u.boundingBox,landmarks:u.landmarks,annotations:h}]]}})})},i}();const en={thumb:[0,1,2,3,4],indexFinger:[0,5,6,7,8],middleFinger:[0,9,10,11,12],ringFinger:[0,13,14,15,16],pinky:[0,17,18,19,20]},Sn=(i,n)=>{i.length>0&&i.map(o=>{const{landmarks:t}=o;Object.keys(en).map(e=>{const s=en[e];for(let r=0;r<s.length-1;r++){const u=s[r],h=s[r+1];n.beginPath(),n.moveTo(t[u][0],t[u][1]),n.lineTo(t[h][0],t[h][1]),n.strokeStyle="#34eb37",n.lineWidth=2,n.stroke()}}),t.map(e=>{const[s,r]=e;n.beginPath(),n.arc(s,r,5,0,2*Math.PI),n.fillStyle="#eb3434",n.fill()})})},En={className:"flex items-center justify-center h-screen w-full bg-blue-100"},Wn={className:"ml-auto mr-auto relative w-[1280px] h-[720px]"},Dn=vn({__name:"Handpose",setup(i){const n=U(null),o=U(null),t=async()=>{const s=await Tn();setInterval(()=>{e(s)},1)},e=async s=>{const r=n.value,u=o.value;if(typeof r<"u"&&r!==null&&r.video.readyState===4){const h=r.video,d=h.videoWidth,a=h.videoHeight;h.width=d,h.height=a,u.width=d,u.height=a;const l=await s.estimateHands(h);console.log(l),Sn(l,u.getContext("2d"))}};return gn(t),(s,r)=>(yn(),Pn("div",En,[q("div",Wn,[bn(mn,{ref_key:"webcamRef",ref:n,className:"w-full h-full absolute"},null,512),q("canvas",{ref_key:"canvasRef",ref:o,className:"w-full h-full top-0 left-0 absolute z-10"},null,512)])]))}});export{Dn as default};
